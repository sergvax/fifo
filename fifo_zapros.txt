ВЫБРАТЬ
	ГрафикПлатежей.Регистратор КАК Регистратор,
	ГрафикПлатежей.Сумма КАК Сумма,
	ГрафикПлатежей.Дата КАК Дата,
	СУММА(ГрафикПлатежей1.Сумма) КАК Сумма1,
	ГрафикПлатежей.НомерСтроки КАК НомерСтроки
ПОМЕСТИТЬ _промежуточныесуммы
ИЗ
	РегистрСведений.ГрафикПлатежей КАК ГрафикПлатежей
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрСведений.ГрафикПлатежей КАК ГрафикПлатежей1
		ПО (ГрафикПлатежей.Регистратор = ГрафикПлатежей1.Регистратор)
			И (ГрафикПлатежей.НомерСтроки >= ГрафикПлатежей1.НомерСтроки)

СГРУППИРОВАТЬ ПО
	ГрафикПлатежей.Регистратор,
	ГрафикПлатежей.Сумма,
	ГрафикПлатежей.Дата,
	ГрафикПлатежей.НомерСтроки
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	_промежуточныесуммы.Регистратор КАК Регистратор,
	_промежуточныесуммы.Сумма КАК Сумма,
	_промежуточныесуммы.Дата КАК Дата,
	_промежуточныесуммы.Сумма1 КАК Сумма1,
	_промежуточныесуммы.НомерСтроки КАК НомерСтроки,
	ПоступленияОстаткиИОбороты.СуммаПриход КАК СуммаПриход,
	ВЫБОР
		КОГДА _промежуточныесуммы.Сумма1 <= ПоступленияОстаткиИОбороты.СуммаПриход
			ТОГДА _промежуточныесуммы.Сумма
		ИНАЧЕ ВЫБОР
				КОГДА ПоступленияОстаткиИОбороты.СуммаПриход + _промежуточныесуммы.Сумма - _промежуточныесуммы.Сумма1 > 0
					ТОГДА ПоступленияОстаткиИОбороты.СуммаПриход + _промежуточныесуммы.Сумма - _промежуточныесуммы.Сумма1
				ИНАЧЕ 0
			КОНЕЦ
	КОНЕЦ КАК Поле1
ИЗ
	_промежуточныесуммы КАК _промежуточныесуммы
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.Поступления.ОстаткиИОбороты КАК ПоступленияОстаткиИОбороты
		ПО (_промежуточныесуммы.Регистратор = ПоступленияОстаткиИОбороты.Договор)

УПОРЯДОЧИТЬ ПО
	НомерСтроки